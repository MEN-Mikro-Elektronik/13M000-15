<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - MDIS kernel for QNX - mdis_kernel.c File Reference</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">MDIS kernel for QNX &nbsp; Release-1.6</h1>
	<h3>mdis_kernel.c File Reference</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mdis_kernel.c File Reference</h1>MDIS kernel resource manager.  
<a href="#_details">More...</a>
<p>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>union &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="union__mk__data__t.html">_mk_data_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>union &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="union__mk__return__t.html">_mk_return_t</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="union__mk__data__t.html">_mk_data_t</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a1">mk_data_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="union__mk__return__t.html">_mk_return_t</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a2">mk_return_t</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a15">main</a> (int argc, char **argv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main routine. </em> <a href="#a15"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a16">MDIS_Handler</a> (void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handler thread for MDIS devices. </em> <a href="#a16"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a17">MDIS_IrqHandler</a> (void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">MDIS kernel IRQ thread. </em> <a href="#a17"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int32&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a18">MDIS_DevLock</a> (<a class="el" href="structMK__PATH.html">MK_PATH</a> *mkPath, <a class="el" href="mk__intern_8h.html#a51">MDIS_CALL</a> call)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lock the device. </em> <a href="#a18"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a19">MDIS_DevUnLock</a> (<a class="el" href="structMK__PATH.html">MK_PATH</a> *mkPath, <a class="el" href="mk__intern_8h.html#a51">MDIS_CALL</a> call)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unlock the device. </em> <a href="#a19"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>pid_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mdis__kernel_8c.html#a21">MDIS_CurrentPid</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the process id of the currently running thread. </em> <a href="#a21"></a><em><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
MDIS kernel resource manager. 
<p>
<dl compact><dt><b>Author:</b></dt><dd><a href="mailto:ulrich.bogensperger@men.de">ulrich.bogensperger@men.de</a> <dl compact><dt><b>Date</b></dt><dd>2014/10/29 11:51:16 </dd></dl>
<dl compact><dt><b>Revision</b></dt><dd>1.8 </dd></dl>
</dd></dl>
<dl compact><dt><b>Project:</b></dt><dd>MDIS4QNX </dd></dl>
<dl compact><dt><b>Preprocessor Switches:</b></dt><dd>USE_VME_SERVER</dd></dl>
<hr><h2>Typedef Documentation</h2>
<a name="a1" doxytag="mdis_kernel.c::mk_data_t"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef union <a class="el" href="union__mk__data__t.html">_mk_data_t</a>  <a class="el" href="union__mk__data__t.html">mk_data_t</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
parameters passed via devctl() call to MDIS kernel     </td>
  </tr>
</table>
<a name="a2" doxytag="mdis_kernel.c::mk_return_t"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef union <a class="el" href="union__mk__return__t.html">_mk_return_t</a>  <a class="el" href="union__mk__return__t.html">mk_return_t</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
return values from devctl() call     </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a15" doxytag="mdis_kernel.c::main"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Main routine. 
<p>
Initialisation of main data structures. Creation of IRQ and Watchdog handler threads. Contains the resource manager main loop.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>argc</em>&nbsp;</td><td><b>IN</b> number of arguments </td></tr>
    <tr><td valign=top><em>argv</em>&nbsp;</td><td><b>IN</b> argument vector</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>error code if init failed </dd></dl>
    </td>
  </tr>
</table>
<a name="a21" doxytag="mdis_kernel.c::MDIS_CurrentPid"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> pid_t MDIS_CurrentPid </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return the process id of the currently running thread. 
<p>
Callback for OSS library.<p>
<dl compact><dt><b>Returns:</b></dt><dd>current PID </dd></dl>
    </td>
  </tr>
</table>
<a name="a18" doxytag="mdis_kernel.c::MDIS_DevLock"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int32 MDIS_DevLock </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structMK__PATH.html">MK_PATH</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mkPath</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="mk__intern_8h.html#a51">MDIS_CALL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>call</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Lock the device. 
<p>
If lock mode is CHAN, locks the channel's sempahore If lock mode is CALL, locks the semaphore pointed to by callSem Finally, locks the device semaphore<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>mkPath</em>&nbsp;</td><td><b>IN</b> MDIS kernel path </td></tr>
    <tr><td valign=top><em>call</em>&nbsp;</td><td><b>IN</b> code for MDIS call semaphore to lock (used only if lock mode is CALL)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success or <code>ERR_OSS_xxx</code> error code on error </dd></dl>
    </td>
  </tr>
</table>
<a name="a19" doxytag="mdis_kernel.c::MDIS_DevUnLock"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MDIS_DevUnLock </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structMK__PATH.html">MK_PATH</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mkPath</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="mk__intern_8h.html#a51">MDIS_CALL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>call</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unlock the device. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>mkPath</em>&nbsp;</td><td><b>IN</b> MDIS kernel path </td></tr>
    <tr><td valign=top><em>call</em>&nbsp;</td><td><b>IN</b> code for MDIS call semaphore to lock (used only if lock mode is CALL) </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a16" doxytag="mdis_kernel.c::MDIS_Handler"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void* MDIS_Handler </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handler thread for MDIS devices. 
<p>
This code is used by all MDIS kernel threads. For every application thread which opens an MDIS device the MDIS kernel creates a handler thread. This "kernel threads" then performs all device operations (read, write etc.) in behalf of the application.<p>
All MDIS kernel thread share the same address space and therefore have access to commonly used data structures inside the MDIS kernel.<p>
For every application thread only one kernel thread is generated even if it opens more than one device. A kernel thread is removed if the last device of the corresponding app thread is closed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>arg</em>&nbsp;</td><td><b>IN</b> thread information</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>never returns </dd></dl>
    </td>
  </tr>
</table>
<a name="a17" doxytag="mdis_kernel.c::MDIS_IrqHandler"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void* MDIS_IrqHandler </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
MDIS kernel IRQ thread. 
<p>
This thread handles interrupt requests from all MDIS devices.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>arg</em>&nbsp;</td><td><b>IN</b> not used</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always NULL </dd></dl>
    </td>
  </tr>
</table>

	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for MDIS kernel for QNX using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2014 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

